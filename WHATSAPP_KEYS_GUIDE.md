# ุฏููู ุงูุญุตูู ุนูู ููุงุชูุญ WhatsApp Business API

ูุฐุง ุงูุฏููู ูุดุฑุญ ุจุงูุชูุตูู ููููุฉ ุงูุญุตูู ุนูู `WHATSAPP_ACCESS_TOKEN` ู `WHATSAPP_PHONE_NUMBER_ID` ุงููุทููุจูู ูุฅุฑุณุงู OTP ุนุจุฑ WhatsApp.

## ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ

1. ุญุณุงุจ Facebook ุดุฎุตู
2. ุญุณุงุจ Meta Business (ูุฌุงูู)
3. ุฑูู ูุงุชู ููุชุญูู

---

## ุงูุฎุทูุฉ 1: ุฅูุดุงุก ุญุณุงุจ Meta Business

### 1.1 ุงูุฐูุงุจ ุฅูู Meta Business Manager

1. ุงุฐูุจ ุฅูู [business.facebook.com](https://business.facebook.com/)
2. ุงุถุบุท ุนูู **"ุฅูุดุงุก ุญุณุงุจ"** ุฃู **"Create Account"**
3. ุฃุฏุฎู ุจูุงูุงุชู:
   - ุงุณู ุงูุนูู (ูููู ุงุณุชุฎุฏุงู ุงุณู ุดุฎุตู)
   - ุงุณูู
   - ุจุฑูุฏู ุงูุฅููุชุฑููู

### 1.2 ุงูุชุญูู ูู ุงูุญุณุงุจ

- ุณุชุญุชุงุฌ ููุชุญูู ูู ุจุฑูุฏู ุงูุฅููุชุฑููู
- ูุฏ ููุทูุจ ููู ุฅุฏุฎุงู ุฑูู ูุงุชู ููุชุญูู

---

## ุงูุฎุทูุฉ 2: ุฅูุดุงุก ุชุทุจูู ูู Meta for Developers

### 2.1 ุงููุตูู ุฅูู Meta for Developers

1. ุงุฐูุจ ุฅูู [developers.facebook.com](https://developers.facebook.com/)
2. ุงุถุบุท ุนูู **"My Apps"** ูู ุงููุงุฆูุฉ ุงูุนูููุฉ
3. ุงุถุบุท ุนูู **"Create App"**

### 2.2 ุงุฎุชูุงุฑ ููุน ุงูุชุทุจูู

1. ุงุฎุชุฑ **"Business"** ูููุน ุงูุชุทุจูู
2. ุงุถุบุท **"Next"**
3. ุฃุฏุฎู:
   - **App Display Name**: ุงุณู ุงูุชุทุจูู (ูุซุงู: "My Booking App")
   - **App Contact Email**: ุจุฑูุฏู ุงูุฅููุชุฑููู
   - **Business Account**: ุงุฎุชุฑ ุญุณุงุจ Meta Business ุงูุฐู ุฃูุดุฃุชู
4. ุงุถุบุท **"Create App"**

### 2.3 ุฅุถุงูุฉ ููุชุฌ WhatsApp

1. ูู ููุญุฉ ุงูุชุญูู ููุชุทุจููุ ุงุจุญุซ ุนู **"WhatsApp"** ูู ูุงุฆูุฉ ุงูููุชุฌุงุช
2. ุงุถุบุท ุนูู **"Set up"** ุจุฌุงูุจ WhatsApp
3. ุงุฎุชุฑ **"Get Started"** ุฃู **"Continue"**

---

## ุงูุฎุทูุฉ 3: ุงูุญุตูู ุนูู Phone Number ID

### 3.1 ุงููุตูู ุฅูู WhatsApp API Setup

1. ูู ููุญุฉ ุงูุชุญููุ ุงุถุบุท ุนูู **"WhatsApp"** ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
2. ุงุถุบุท ุนูู **"API Setup"** ูู ุงููุงุฆูุฉ ุงููุฑุนูุฉ

### 3.2 ุงูุญุตูู ุนูู Phone Number ID

ุณุชุฌุฏ ูู ุตูุญุฉ **"API Setup"**:

- **Phone number ID**: ูุฐุง ูู ุงูููุชุงุญ ุงูุฃูู ุงูุฐู ุชุญุชุงุฌู
  - ูุซุงู: `123456789012345`
  - ุงูุณุฎ ูุฐุง ุงูุฑูู ูุงุญูุธู

**ููุงุญุธุฉ**: ุฅุฐุง ูู ููู ูุฏูู ุฑูู ูุงุชู ูุฑุชุจุท:
1. ุงุถุบุท ุนูู **"Add phone number"**
2. ุงุชุจุน ุงูุชุนูููุงุช ูุฅุถุงูุฉ ุฑูู ูุงุชู WhatsApp Business
3. ูุฏ ุชุญุชุงุฌ ููุชุญูู ูู ุงูุฑูู ุนุจุฑ ุฑุณุงูุฉ SMS ุฃู ููุงููุฉ

---

## ุงูุฎุทูุฉ 4: ุงูุญุตูู ุนูู Access Token

### 4.1 ุฅูุดุงุก Access Token ูุคูุช (ููุงุฎุชุจุงุฑ)

1. ูู ุตูุญุฉ **"API Setup"**ุ ุงุจุญุซ ุนู ูุณู **"Temporary access token"**
2. ุงุถุบุท ุนูู **"Generate token"**
3. ุงุฎุชุฑ ุญุณุงุจ WhatsApp Business ุงููุฑุชุจุท
4. ุงูุณุฎ ุงูู Token ุงูุฐู ุณูุธูุฑ
   - ูุซุงู: `EAABwzLixZC...` (ุทููู ุฌุฏุงู)

**โ๏ธ ุชุญุฐูุฑ**: ูุฐุง Token ูุคูุช ููุฏูู 24 ุณุงุนุฉ ููุท ููุงุฎุชุจุงุฑ

### 4.2 ุฅูุดุงุก Access Token ุฏุงุฆู (ููุฅูุชุงุฌ)

ููุญุตูู ุนูู Token ุฏุงุฆูุ ุชุญุชุงุฌ ุฅูู:

#### ุฃ) ุฅูุดุงุก System User

1. ุงุฐูุจ ุฅูู [business.facebook.com/settings](https://business.facebook.com/settings)
2. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุถุบุท ุนูู **"Users"**
3. ุงุถุบุท ุนูู **"System Users"**
4. ุงุถุบุท ุนูู **"Add"** ูุฅูุดุงุก System User ุฌุฏูุฏ
5. ุฃุฏุฎู:
   - **Name**: ุงุณู (ูุซุงู: "WhatsApp API User")
   - **System User Role**: ุงุฎุชุฑ **"Admin"** ุฃู **"Employee"**
6. ุงุถุบุท **"Create System User"**

#### ุจ) ุฑุจุท System User ุจุงูุชุทุจูู

1. ูู ุตูุญุฉ System Usersุ ุงุถุบุท ุนูู System User ุงูุฐู ุฃูุดุฃุชู
2. ุงุถุบุท ุนูู **"Assign Assets"**
3. ุงุฎุชุฑ:
   - **Apps**: ุงุฎุชุฑ ุงูุชุทุจูู ุงูุฐู ุฃูุดุฃุชู
   - **Permissions**: ุงุฎุชุฑ **"WhatsApp Business Management"**
4. ุงุถุบุท **"Save Changes"**

#### ุฌ) ุฅูุดุงุก Access Token ูููุธุงู

1. ูู ุตูุญุฉ System Userุ ุงุถุบุท ุนูู **"Generate New Token"**
2. ุงุฎุชุฑ ุงูุชุทุจูู ุงูุฐู ุฃูุดุฃุชู
3. ุงุฎุชุฑ ุงูุตูุงุญูุงุช:
   - โ `whatsapp_business_messaging`
   - โ `whatsapp_business_management`
4. ุงุถุบุท **"Generate Token"**
5. **โ๏ธ ููู ุฌุฏุงู**: ุงูุณุฎ ุงูู Token ููุฑุงู ูุงุญูุธู ูู ููุงู ุขูู
   - ูู ุชุชููู ูู ุฑุคูุชู ูุฑุฉ ุฃุฎุฑู ุจุนุฏ ุฅุบูุงู ุงููุงูุฐุฉ!

---

## ุงูุฎุทูุฉ 5: ุฅุถุงูุฉ ุงูููุงุชูุญ ุฅูู ุงููุดุฑูุน

### 5.1 ุฅุถุงูุฉ ุฅูู ููู .env

ุฃูุดุฆ ุฃู ุนุฏูู ููู `.env` ูู ูุฌูุฏ `loopmsq/apps/api/`:

```env
# WhatsApp Business API Configuration
WHATSAPP_ACCESS_TOKEN=EAABwzLixZC...your_token_here
WHATSAPP_PHONE_NUMBER_ID=123456789012345
```

### 5.2 ุฅุถุงูุฉ ุฅูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ูู Docker

ุฅุฐุง ููุช ุชุณุชุฎุฏู Dockerุ ุฃุถู ุงููุชุบูุฑุงุช ุฅูู ููู `.env` ูู ุฌุฐุฑ ุงููุดุฑูุน:

```env
WHATSAPP_ACCESS_TOKEN=your_token_here
WHATSAPP_PHONE_NUMBER_ID=your_phone_number_id_here
```

ุซู ุฃุนุฏ ุชุดุบูู ุงูุญุงููุงุช:

```bash
docker-compose down
docker-compose up -d
```

---

## ุงูุฎุทูุฉ 6: ุงูุชุญูู ูู ุงูุฅุนุฏุงุฏ

### 6.1 ุงุฎุชุจุงุฑ ุงูุฅุฑุณุงู

ุจุนุฏ ุฅุถุงูุฉ ุงูููุงุชูุญุ ุงุฎุชุจุฑ ุฅุฑุณุงู OTP:

```bash
POST /api/v1/auth/otp/send
Content-Type: application/json

{
  "phone": "+966500000000",
  "language": "ar"
}
```

### 6.2 ุงูุชุญูู ูู ุงูุณุฌูุงุช

ุชุญูู ูู ุณุฌูุงุช ุงูุฎุงุฏู ููุชุฃูุฏ ูู ูุฌุงุญ ุงูุฅุฑุณุงู:

```
โ WhatsApp OTP sent to +966500000000: 123456
```

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ

### โ ุฎุทุฃ: "Invalid OAuth access token"

**ุงูุณุจุจ**: Access Token ุบูุฑ ุตุญูุญ ุฃู ููุชูู ุงูุตูุงุญูุฉ

**ุงูุญู**:
- ุชุญูู ูู ุฃู Token ุตุญูุญ (ูุณุฎ ูุงูู)
- ุฅุฐุง ูุงู Token ูุคูุชุ ุฃูุดุฆ Token ุฏุงุฆู
- ุชุฃูุฏ ูู ุฃู Token ูู ุงูุตูุงุญูุงุช ุงููุทููุจุฉ

### โ ุฎุทุฃ: "Phone number not found"

**ุงูุณุจุจ**: Phone Number ID ุบูุฑ ุตุญูุญ

**ุงูุญู**:
- ุชุญูู ูู Phone Number ID ูู ุตูุญุฉ API Setup
- ุชุฃูุฏ ูู ุฃู ุฑูู ุงููุงุชู ูุฑุชุจุท ุจุญุณุงุจ WhatsApp Business

### โ ุฎุทุฃ: "Template not found"

**ุงูุณุจุจ**: ุงููุงูุจ `authentication_code` ุบูุฑ ูุชุงุญ

**ุงูุญู**:
- ุงููุงูุจ `authentication_code` ูุงูุจ ุฌุงูุฒ ูู Meta
- ุชุฃูุฏ ูู ุฃู ุญุณุงุจ WhatsApp Business ูุดุท
- ูุฏ ุชุญุชุงุฌ ููุงูุชุธุงุฑ ููููุงู ุจุนุฏ ุฅูุดุงุก ุงูุญุณุงุจ

### โ ุฎุทุฃ: "Rate limit exceeded"

**ุงูุณุจุจ**: ุชุฌุงูุฒ ุงูุญุฏ ุงููุณููุญ ูู ุงูุฑุณุงุฆู

**ุงูุญู**:
- ุงูุชุธุฑ ููููุงู ูุจู ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- ูู ูุฑุญูุฉ ุงูุงุฎุชุจุงุฑุ Meta ุชุถุน ุญุฏูุฏุงู ุนูู ุนุฏุฏ ุงูุฑุณุงุฆู

---

## ูุตุงุฆุญ ูููุฉ

### ๐ ุงูุฃูุงู

1. **ูุง ุชุดุงุฑู Access Token** ูุน ุฃู ุดุฎุต
2. **ูุง ุชุฑูุน Token ุฅูู Git** - ุชุฃูุฏ ูู ุฅุถุงูุชู ุฅูู `.gitignore`
3. **ุงุณุชุฎุฏู Token ุฏุงุฆู** ููุฅูุชุงุฌุ ูููุณ Token ูุคูุช

### ๐ฑ ุฑูู ุงููุงุชู

- ููููู ุงุณุชุฎุฏุงู ุฑูู ูุงุชู ุนุงุฏู ููุงุฎุชุจุงุฑ
- ููุฅูุชุงุฌุ ูุฏ ุชุญุชุงุฌ ุฑูู ูุงุชู ูุฎุตุต ููุฃุนูุงู
- Meta ุชููุฑ ุฃุฑูุงู ุชุฌุฑูุจูุฉ ููุงุฎุชุจุงุฑ

### ๐ฐ ุงูุชูููุฉ

- ููุงูุจ ุงููุตุงุฏูุฉ (OTP) **ูุฌุงููุฉ** ูู ูุนุธู ุงูุจูุฏุงู
- ูุง ุชูุฌุฏ ุชูููุฉ ุฅุถุงููุฉ ูุงุณุชุฎุฏุงู WhatsApp Business API ููู OTP

---

## ุฑูุงุจุท ูููุฏุฉ

- [Meta Business Manager](https://business.facebook.com/)
- [Meta for Developers](https://developers.facebook.com/)
- [WhatsApp Business API Documentation](https://developers.facebook.com/docs/whatsapp)
- [WhatsApp API Reference](https://developers.facebook.com/docs/whatsapp/cloud-api/reference)

---

## ููุฎุต ุณุฑูุน

1. โ ุฅูุดุงุก ุญุณุงุจ Meta Business
2. โ ุฅูุดุงุก ุชุทุจูู ูู Meta for Developers
3. โ ุฅุถุงูุฉ ููุชุฌ WhatsApp ููุชุทุจูู
4. โ ุงูุญุตูู ุนูู Phone Number ID ูู API Setup
5. โ ุฅูุดุงุก Access Token (ูุคูุช ููุงุฎุชุจุงุฑ ุฃู ุฏุงุฆู ููุฅูุชุงุฌ)
6. โ ุฅุถุงูุฉ ุงูููุงุชูุญ ุฅูู ููู `.env`
7. โ ุงุฎุชุจุงุฑ ุงูุฅุฑุณุงู

---

## ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ูุดุงูู:
1. ุชุญูู ูู ุณุฌูุงุช ุงูุฎุงุฏู
2. ุฑุงุฌุน [ูุซุงุฆู WhatsApp Business API](https://developers.facebook.com/docs/whatsapp)
3. ุชุญูู ูู [Meta Business Help Center](https://www.facebook.com/business/help)









